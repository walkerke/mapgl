<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Building story maps with mapgl • mapgl</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Building story maps with mapgl">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mapgl</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting-started.html">Getting started with mapgl</a></li>
    <li><a class="dropdown-item" href="../articles/layers-overview.html">An overview of layers in mapgl</a></li>
    <li><a class="dropdown-item" href="../articles/map-design.html">Fundamentals of map design with mapgl</a></li>
    <li><a class="dropdown-item" href="../articles/margins-of-error.html">Using mapgl with Shiny</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/walkerke/mapgl/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Building story maps with mapgl</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/walkerke/mapgl/blob/HEAD/vignettes/story-maps.Rmd" class="external-link"><code>vignettes/story-maps.Rmd</code></a></small>
      <div class="d-none name"><code>story-maps.Rmd</code></div>
    </div>

    
    
<p><em>Story maps</em> are effective tools for communicating map-based
narratives. In a story map, users typically scroll through a web page in
which different map views and elements of the “story” are shown as the
user scrolls down. The <strong>mapgl</strong> package brings story maps
in Shiny to R users, and supports both Mapbox and MapLibre backends as
well as Leaflet.</p>
<p>This tutorial will help you learn how to build a basic story map
Shiny app with mapgl. You’ll rely on the following three functions when
building your story:</p>
<ul>
<li><p><code><a href="../reference/story_map.html">story_map()</a></code> sets up the user interface component for
your story map. You’ll wrap this in a Shiny layout function; it is
recommended to use <code><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage()</a></code> (or
<code><a href="https://rstudio.github.io/bslib/reference/page.html" class="external-link">bslib::page_fluid()</a></code>) which will get you a standard
full-screen story map template. <code><a href="../reference/story_map.html">story_map()</a></code> defaults to
Mapbox maps; you can use <code><a href="../reference/story_maplibre.html">story_maplibre()</a></code> for MapLibre
maps, and <code><a href="../reference/story_leaflet.html">story_leaflet()</a></code> for Leaflet.</p></li>
<li><p>Within <code><a href="../reference/story_map.html">story_map()</a></code>, you’ll define a named list of
sections to be passed to the <code>sections</code> parameter. You’ll use
the <code><a href="../reference/story_section.html">story_section()</a></code> function to build each section. In
<code><a href="../reference/story_section.html">story_section()</a></code>, you’ll specify a <code>title</code> (set
to NULL or <code>""</code> to omit it) as well as <code>content</code>,
which will be a list of UI elements you want to put in your section
panel. This can be HTML elements (defined with <code>tags$p()</code>,
<code>tags$a()</code>, <code>tags$img()</code>, etc.) as well as Shiny
inputs or outputs.</p></li>
<li><p>Within your <code>server</code> function, you’ll then use the
<code><a href="../reference/on_section.html">on_section()</a></code> function to bring your story map to life.
<code><a href="../reference/on_section.html">on_section()</a></code> allows you to link Shiny events to specific
story sections. This means that you can trigger map movements, add data,
or even perform analyses on user scroll.</p></li>
</ul>
<div class="section level2">
<h2 id="moving-the-map-on-scroll">Moving the map on scroll<a class="anchor" aria-label="anchor" href="#moving-the-map-on-scroll"></a>
</h2>
<p>Let’s take a look at how this works with a basic example. We’ll build
a story map with two sections: an introductory section, and a second
section where the map “flies to” a location when the user scrolls.</p>
<p>To get started, let’s build a basic user interface without any map
actions. In <code>ui</code>, we set up <code><a href="../reference/story_map.html">story_map()</a></code> inside a
fluid page with two sections. In <code>server</code>, we’ll create a
Mapbox globe with <code><a href="../reference/mapboxgl.html">mapboxgl()</a></code> and
<code><a href="../reference/renderMapboxgl.html">renderMapboxgl()</a></code>. In most cases you’ll want to set the
option <code>scrollZoom = FALSE</code> when you initialize your map so
map scrolling behavior doesn’t interfere with story scrolling.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://walker-data.com/mapgl/">mapgl</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/story_map.html">story_map</a></span><span class="op">(</span></span>
<span>    map_id <span class="op">=</span> <span class="st">"map"</span>,</span>
<span>    sections <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="st">"intro"</span> <span class="op">=</span> <span class="fu"><a href="../reference/story_section.html">story_section</a></span><span class="op">(</span></span>
<span>        <span class="st">"Introduction"</span>,</span>
<span>        <span class="st">"This is a story map."</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="st">"location"</span> <span class="op">=</span> <span class="fu"><a href="../reference/story_section.html">story_section</a></span><span class="op">(</span></span>
<span>        <span class="st">"Location"</span>,</span>
<span>        <span class="st">"Check out this interesting location."</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/renderMapboxgl.html">renderMapboxgl</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/mapboxgl.html">mapboxgl</a></span><span class="op">(</span>scrollZoom <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></code></pre></div>
<p><img src="images%2Fstory-1a.gif"></p>
<p>You’ll note that scrolling will transition between story sections,
and that you can still interact with the map by clicking and panning.
However, because we haven’t set up any actions in <code>server</code>,
nothing else happens when you scroll between sections.</p>
<p>We can change this by using the <code><a href="../reference/on_section.html">on_section()</a></code> function.
In <code><a href="../reference/on_section.html">on_section()</a></code>, you’ll specify the map ID (in this case,
<code>"map"</code>) and the section ID to link to an action; the section
ID is the name of the corresponding list element defined in the list
passed to <code>sections</code> in the UI. You’ll then define an
expression, much like you would in <code><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent()</a></code> in Shiny,
to be executed when a given section appears.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://walker-data.com/mapgl/">mapgl</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/story_map.html">story_map</a></span><span class="op">(</span></span>
<span>    map_id <span class="op">=</span> <span class="st">"map"</span>,</span>
<span>    sections <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="st">"intro"</span> <span class="op">=</span> <span class="fu"><a href="../reference/story_section.html">story_section</a></span><span class="op">(</span></span>
<span>        <span class="st">"Introduction"</span>,</span>
<span>        <span class="st">"This is a story map."</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="st">"location"</span> <span class="op">=</span> <span class="fu"><a href="../reference/story_section.html">story_section</a></span><span class="op">(</span></span>
<span>        <span class="st">"Location"</span>,</span>
<span>        <span class="st">"Check out this interesting location."</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/renderMapboxgl.html">renderMapboxgl</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/mapboxgl.html">mapboxgl</a></span><span class="op">(</span>scrollZoom <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/on_section.html">on_section</a></span><span class="op">(</span><span class="st">"map"</span>, <span class="st">"location"</span>, <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/mapboxgl_proxy.html">mapboxgl_proxy</a></span><span class="op">(</span><span class="st">"map"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="../reference/fly_to.html">fly_to</a></span><span class="op">(</span>center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12.49257</span>, <span class="fl">41.890233</span><span class="op">)</span>, </span>
<span>             zoom <span class="op">=</span> <span class="fl">17.5</span>,</span>
<span>             pitch <span class="op">=</span> <span class="fl">49</span>,</span>
<span>             bearing <span class="op">=</span> <span class="fl">12.8</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></code></pre></div>
<p><img src="images%2Fstory-1b.gif"></p>
<p>The map zooms into the Colosseum in Rome on user scroll. If you
scroll back up to the top, however, you’ll notice that the view does not
return to the original globe. This can be remedied by tying an
<code><a href="../reference/on_section.html">on_section()</a></code> event to the introductory section.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://walker-data.com/mapgl/">mapgl</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/story_map.html">story_map</a></span><span class="op">(</span></span>
<span>    map_id <span class="op">=</span> <span class="st">"map"</span>,</span>
<span>    sections <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="st">"intro"</span> <span class="op">=</span> <span class="fu"><a href="../reference/story_section.html">story_section</a></span><span class="op">(</span></span>
<span>        <span class="st">"Introduction"</span>,</span>
<span>        <span class="st">"This is a story map."</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="st">"location"</span> <span class="op">=</span> <span class="fu"><a href="../reference/story_section.html">story_section</a></span><span class="op">(</span></span>
<span>        <span class="st">"Location"</span>,</span>
<span>        <span class="st">"Check out this interesting location."</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/renderMapboxgl.html">renderMapboxgl</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/mapboxgl.html">mapboxgl</a></span><span class="op">(</span>scrollZoom <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/on_section.html">on_section</a></span><span class="op">(</span><span class="st">"map"</span>, <span class="st">"intro"</span>, <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/mapboxgl_proxy.html">mapboxgl_proxy</a></span><span class="op">(</span><span class="st">"map"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="../reference/fly_to.html">fly_to</a></span><span class="op">(</span>center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>             zoom <span class="op">=</span> <span class="fl">0</span>,</span>
<span>             pitch <span class="op">=</span> <span class="fl">0</span>,</span>
<span>             bearing <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/on_section.html">on_section</a></span><span class="op">(</span><span class="st">"map"</span>, <span class="st">"location"</span>, <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/mapboxgl_proxy.html">mapboxgl_proxy</a></span><span class="op">(</span><span class="st">"map"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="../reference/fly_to.html">fly_to</a></span><span class="op">(</span>center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12.49257</span>, <span class="fl">41.890233</span><span class="op">)</span>, </span>
<span>             zoom <span class="op">=</span> <span class="fl">17.5</span>,</span>
<span>             pitch <span class="op">=</span> <span class="fl">49</span>,</span>
<span>             bearing <span class="op">=</span> <span class="fl">12.8</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></code></pre></div>
<p><img src="images%2Fstory-1c.gif"></p>
<p>For map transitions, in addition to <code><a href="../reference/fly_to.html">fly_to()</a></code>, you might
consider using <code><a href="../reference/ease_to.html">ease_to()</a></code> and <code><a href="../reference/jump_to.html">jump_to()</a></code>
depending on your use case. Map transition functions support <a href="https://docs.mapbox.com/mapbox-gl-js/api/properties/#cameraoptions" class="external-link">camera
options</a> and <a href="https://docs.mapbox.com/mapbox-gl-js/api/properties/#animationoptions" class="external-link">animation
options</a> as keyword arguments when applicable.</p>
</div>
<div class="section level2">
<h2 id="adding-data-and-modifying-story-appearance">Adding data and modifying story appearance<a class="anchor" aria-label="anchor" href="#adding-data-and-modifying-story-appearance"></a>
</h2>
<p>In many cases, you’ll want to use story maps to visualize data that
you’ll add to a Mapbox / MapLibre basemap. Let’s build an example of how
a real estate firm might use a story map to market a property.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://walker-data.com/mapgl/">mapgl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/walkerke/mapboxapi" class="external-link">mapboxapi</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">property</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">97.71326</span>, <span class="fl">30.402550</span><span class="op">)</span></span>
<span><span class="va">isochrone</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/mapboxapi/reference/mb_isochrone.html" class="external-link">mb_isochrone</a></span><span class="op">(</span><span class="va">property</span>, profile <span class="op">=</span> <span class="st">"driving"</span>, time <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>  <span class="va">tags</span><span class="op">$</span><span class="fu">link</span><span class="op">(</span>href <span class="op">=</span> <span class="st">"https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&amp;display=swap"</span>, rel<span class="op">=</span><span class="st">"stylesheet"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/story_map.html">story_map</a></span><span class="op">(</span></span>
<span>    map_id <span class="op">=</span> <span class="st">"map"</span>,</span>
<span>    font_family <span class="op">=</span> <span class="st">"Poppins"</span>,</span>
<span>    sections <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="st">"intro"</span> <span class="op">=</span> <span class="fu"><a href="../reference/story_section.html">story_section</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"MULTIFAMILY INVESTMENT OPPORTUNITY"</span>,</span>
<span>        content <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">p</a></span><span class="op">(</span><span class="st">"New Class A Apartments in Austin, Texas"</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">img</a></span><span class="op">(</span>src <span class="op">=</span> <span class="st">"apartment.png"</span>, width <span class="op">=</span> <span class="st">"300px"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        position <span class="op">=</span> <span class="st">"center"</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="st">"marker"</span> <span class="op">=</span> <span class="fu"><a href="../reference/story_section.html">story_section</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"PROPERTY LOCATION"</span>,</span>
<span>        content <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">p</a></span><span class="op">(</span><span class="st">"The property will be located in the thriving Domain district of north Austin, home to some of the city's best shopping, dining, and entertainment."</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="st">"isochrone"</span> <span class="op">=</span> <span class="fu"><a href="../reference/story_section.html">story_section</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"AUSTIN AT YOUR FINGERTIPS"</span>,</span>
<span>        content <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">p</a></span><span class="op">(</span><span class="st">"The property is within a 20-minute drive of downtown Austin, the University of Texas, and the city's major employers."</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/renderMapboxgl.html">renderMapboxgl</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/mapboxgl.html">mapboxgl</a></span><span class="op">(</span>scrollZoom <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>             center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">97.7301093</span>, <span class="fl">30.288647</span><span class="op">)</span>,</span>
<span>             zoom <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/on_section.html">on_section</a></span><span class="op">(</span><span class="st">"map"</span>, <span class="st">"intro"</span>, <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/mapboxgl_proxy.html">mapboxgl_proxy</a></span><span class="op">(</span><span class="st">"map"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/clear_markers.html">clear_markers</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/fly_to.html">fly_to</a></span><span class="op">(</span>center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">97.7301093</span>, <span class="fl">30.288647</span><span class="op">)</span>,</span>
<span>             zoom <span class="op">=</span> <span class="fl">12</span>,</span>
<span>             pitch <span class="op">=</span> <span class="fl">0</span>,</span>
<span>             bearing <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/on_section.html">on_section</a></span><span class="op">(</span><span class="st">"map"</span>, <span class="st">"marker"</span>, <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/mapboxgl_proxy.html">mapboxgl_proxy</a></span><span class="op">(</span><span class="st">"map"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/clear_layer.html">clear_layer</a></span><span class="op">(</span><span class="st">"isochrone"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/add_markers.html">add_markers</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">property</span>, color <span class="op">=</span> <span class="st">"#CC5500"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/fly_to.html">fly_to</a></span><span class="op">(</span>center <span class="op">=</span> <span class="va">property</span>,</span>
<span>             zoom <span class="op">=</span> <span class="fl">16</span>,</span>
<span>             pitch <span class="op">=</span> <span class="fl">45</span>,</span>
<span>             bearing <span class="op">=</span> <span class="op">-</span><span class="fl">90</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/on_section.html">on_section</a></span><span class="op">(</span><span class="st">"map"</span>, <span class="st">"isochrone"</span>, <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/mapboxgl_proxy.html">mapboxgl_proxy</a></span><span class="op">(</span><span class="st">"map"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/add_fill_layer.html">add_fill_layer</a></span><span class="op">(</span></span>
<span>        id <span class="op">=</span> <span class="st">"isochrone"</span>,</span>
<span>        source <span class="op">=</span> <span class="va">isochrone</span>,</span>
<span>        fill_color <span class="op">=</span> <span class="st">"#CC5500"</span>,</span>
<span>        fill_opacity <span class="op">=</span> <span class="fl">0.5</span></span>
<span>      <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/fit_bounds.html">fit_bounds</a></span><span class="op">(</span></span>
<span>        <span class="va">isochrone</span>,</span>
<span>        animate <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        duration <span class="op">=</span> <span class="fl">8000</span>,</span>
<span>        pitch <span class="op">=</span> <span class="fl">75</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></code></pre></div>
<p><img src="images%2Fstory-2.gif"></p>
<p>Let’s break down some key elements of this story map.</p>
<ul>
<li><p>We’re loading a Google font, “Poppins”, into our Shiny app with
<code>tags$link()</code>. This allows us to use Poppins as our font
globally in <code><a href="../reference/story_map.html">story_map()</a></code> by passing it as an argument to
<code>font_family</code>. The appearance of panels can also be modified
section-by-section if you prefer.</p></li>
<li><p>In each story section panel, we are passing a list of HTML items
to <code>content</code>. The introductory section shows how to include a
local image (which should be in a <code>www</code> folder local to your
app); you can also reference remotely-hosted images or include all other
HTML elements supported by Shiny. Also note the
<code>position = "center"</code> argument to position the introductory
panel in the center of the screen; <code>"left"</code> is the default,
and <code>"right"</code> is also supported without the need for
additional CSS customization.</p></li>
<li><p>As in the first example, all of our story actions defined in
calls to <code><a href="../reference/on_section.html">on_section()</a></code> operate on the Mapbox GL proxy
object, <code>"map"</code>. In this example, we use
<code><a href="../reference/add_markers.html">add_markers()</a></code> to add a marker at a location, and
<code><a href="../reference/add_fill_layer.html">add_fill_layer()</a></code> to add a 20-minute drivetime isochrone
created with the Mapbox API. Transitions between the views are handled
with <code><a href="../reference/fly_to.html">fly_to()</a></code> and <code><a href="../reference/fit_bounds.html">fit_bounds()</a></code>, and
<code><a href="../reference/clear_layer.html">clear_layer()</a></code> and <code><a href="../reference/clear_markers.html">clear_markers()</a></code> calls are
used to control which data layers are visible as the user goes forward
and backward through the story.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="integrating-shiny-inputs-and-outputs">Integrating Shiny inputs and outputs<a class="anchor" aria-label="anchor" href="#integrating-shiny-inputs-and-outputs"></a>
</h2>
<p>While the story map feature in <strong>mapgl</strong> is built in a
unique way to accommodate map-based scrollytelling, it is still creating
an R Shiny app. This means that all of Shiny’s functionality and
interactivity is available to you as you build your story maps. The list
of items you pass to <code>content</code> in any given story section
panel can include both Shiny <em>inputs</em> as well as Shiny
<em>outputs</em> which can correspond to the content visible on your
story maps.</p>
<p>Let’s set up a scenario that adds interactivity to the data displayed
in the <a href="https://walker-data.com/mapgl/articles/map-design.html">Fundamentals
of map design with mapgl</a> vignette. We’ll make a map of median age in
Florida, which will display with the introductory story panel. The user
selects a county to display; on scroll, the story will then zoom to the
selected county and show a histogram of values for Census tracts in that
county.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://walker-data.com/mapgl/">mapgl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://walker-data.com/tidycensus/" class="external-link">tidycensus</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">fl_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html" class="external-link">get_acs</a></span><span class="op">(</span></span>
<span>  geography <span class="op">=</span> <span class="st">"tract"</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"B01002_001"</span>,</span>
<span>  state <span class="op">=</span> <span class="st">"FL"</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2023</span>,</span>
<span>  geometry <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html" class="external-link">separate_wider_delim</a></span><span class="op">(</span><span class="va">NAME</span>, delim <span class="op">=</span> <span class="st">"; "</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tract"</span>, <span class="st">"county"</span>, <span class="st">"state"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/story_maplibre.html">story_maplibre</a></span><span class="op">(</span></span>
<span>    map_id <span class="op">=</span> <span class="st">"map"</span>,</span>
<span>    sections <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="st">"intro"</span> <span class="op">=</span> <span class="fu"><a href="../reference/story_section.html">story_section</a></span><span class="op">(</span></span>
<span>        <span class="st">"Median Age in Florida"</span>,</span>
<span>        content <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html" class="external-link">selectInput</a></span><span class="op">(</span></span>
<span>            <span class="st">"county"</span>,</span>
<span>            <span class="st">"Select a county"</span>,</span>
<span>            choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">fl_age</span><span class="op">$</span><span class="va">county</span><span class="op">)</span><span class="op">)</span></span>
<span>          <span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">p</a></span><span class="op">(</span><span class="st">"Scroll down to view the median age distribution in the selected county."</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="st">"county"</span> <span class="op">=</span> <span class="fu"><a href="../reference/story_section.html">story_section</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        content <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html" class="external-link">uiOutput</a></span><span class="op">(</span><span class="st">"county_text"</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html" class="external-link">plotOutput</a></span><span class="op">(</span><span class="st">"county_plot"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">sel_county</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">fl_age</span>, <span class="va">county</span> <span class="op">==</span> <span class="va">input</span><span class="op">$</span><span class="va">county</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/renderMaplibre.html">renderMaplibre</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/maplibre.html">maplibre</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/carto_style.html">carto_style</a></span><span class="op">(</span><span class="st">"positron"</span><span class="op">)</span>,</span>
<span>      bounds <span class="op">=</span> <span class="va">fl_age</span>,</span>
<span>      scrollZoom <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/add_fill_layer.html">add_fill_layer</a></span><span class="op">(</span></span>
<span>        id <span class="op">=</span> <span class="st">"fl_tracts"</span>,</span>
<span>        source <span class="op">=</span> <span class="va">fl_age</span>,</span>
<span>        fill_color <span class="op">=</span> <span class="fu"><a href="../reference/interpolate.html">interpolate</a></span><span class="op">(</span></span>
<span>          column <span class="op">=</span> <span class="st">"estimate"</span>,</span>
<span>          values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">80</span><span class="op">)</span>,</span>
<span>          stops <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lightblue"</span>, <span class="st">"darkblue"</span><span class="op">)</span>,</span>
<span>          na_color <span class="op">=</span> <span class="st">"lightgrey"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        fill_opacity <span class="op">=</span> <span class="fl">0.5</span></span>
<span>      <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/add_legend.html">add_legend</a></span><span class="op">(</span></span>
<span>        <span class="st">"Median age in Florida"</span>,</span>
<span>        values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">80</span><span class="op">)</span>,</span>
<span>        colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lightblue"</span>, <span class="st">"darkblue"</span><span class="op">)</span>,</span>
<span>        position <span class="op">=</span> <span class="st">"bottom-right"</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">county_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html" class="external-link">renderUI</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">toupper</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">county</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">county_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html" class="external-link">renderPlot</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu">sel_county</span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"lightblue"</span>, color <span class="op">=</span> <span class="st">"black"</span>, bins <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Median Age"</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/on_section.html">on_section</a></span><span class="op">(</span><span class="st">"map"</span>, <span class="st">"intro"</span>, <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/maplibre_proxy.html">maplibre_proxy</a></span><span class="op">(</span><span class="st">"map"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/set_filter.html">set_filter</a></span><span class="op">(</span><span class="st">"fl_tracts"</span>, <span class="cn">NULL</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/fit_bounds.html">fit_bounds</a></span><span class="op">(</span><span class="va">fl_age</span>, animate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/on_section.html">on_section</a></span><span class="op">(</span><span class="st">"map"</span>, <span class="st">"county"</span>, <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/maplibre_proxy.html">maplibre_proxy</a></span><span class="op">(</span><span class="st">"map"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/set_filter.html">set_filter</a></span><span class="op">(</span><span class="st">"fl_tracts"</span>, filter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"=="</span>, <span class="st">"county"</span>, <span class="va">input</span><span class="op">$</span><span class="va">county</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/fit_bounds.html">fit_bounds</a></span><span class="op">(</span><span class="fu">sel_county</span><span class="op">(</span><span class="op">)</span>, animate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></code></pre></div>
<p><img src="images%2Fstory-3.gif"></p>
<p>Let’s walk through how this works.</p>
<ul>
<li><p>The UI code will be familiar, though we are now using the
MapLibre backend with <code><a href="../reference/story_maplibre.html">story_maplibre()</a></code>. The main difference
is our inclusion of a Shiny <code><a href="https://rdrr.io/pkg/shiny/man/selectInput.html" class="external-link">selectInput()</a></code> in the first
story panel and two Shiny outputs in the second story panel. As we’ve
set it up, users can select a county at the beginning of the story, and
then get a different output when they scroll down.</p></li>
<li><p>A reactive object <code>sel_county()</code> will be used to get
county-specific values for the second story panel, and will help us
determine the map’s extent as we want to zoom to the selected
county.</p></li>
<li><p>That said, we don’t use <code>sel_county()</code> directly on the
map. Instead, we use mapgl’s <code><a href="../reference/set_filter.html">set_filter()</a></code> function, which
is more performant than filtering data by clearing a layer and re-adding
it. This allows us to invoke the underlying <code>setFilter()</code>
JavaScript method (<a href="https://maplibre.org/maplibre-gl-js/docs/API/classes/Map/#setfilter" class="external-link">see
here for more documentation</a>) and operate directly on the map layer
itself. Setting the filter to <code>NULL</code> clears the filter and
gives us back the entire state of Florida.</p></li>
<li><p>We note that the content of the second panel is entirely Shiny
outputs: an h2 header that corresponds to the selected county, and a
histogram of median age values for Census tracts in that county drawn
with ggplot2.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="sharing-your-stories-next-steps">Sharing your stories / next steps<a class="anchor" aria-label="anchor" href="#sharing-your-stories-next-steps"></a>
</h2>
<p>As your story map is a Shiny app, you’ll need to publish it to a
Shiny server to share it. Posit’s <a href="https://www.shinyapps.io/" class="external-link">ShinyApps.io</a> and <a href="https://connect.posit.cloud/" class="external-link">Connect Cloud</a> products are nice
options if you don’t want to set up your own Shiny server.</p>
<p>If you are building story maps with mapgl, please let me know about
it! I’m also planning some trainings / workshops on this feature, so
please do reach out if you are interested.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://walker-data.com" class="external-link">Kyle Walker</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
